-- // ========================================== //
-- //   DOLLARWARE GEMINI BANK AUTO (PASSIVE)    //
-- // ========================================== //

-- [[ 1. DOLLARWARE LIBRARY SETUP ]] --
local uiLoader = loadstring(game:HttpGet('https://raw.githubusercontent.com/topitbopit/dollarware/main/library.lua'))
local ui = uiLoader({
    rounding = true,
    theme = 'midnight', 
    smoothDragging = true
})

-- [[ 2. VARIABLES & SERVICES ]] --
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualInputManager = game:GetService("VirtualInputManager")
local LocalPlayer = Players.LocalPlayer

-- Global Config
local Config = {
    Enabled = false,
    Speed = 30
}

-- [[ 3. LOGIC FUNCTIONS ]] --

-- PASSIVE MODE (Single Trigger)
local function TogglePassiveMode()
    local pm = ReplicatedStorage:FindFirstChild("PassiveMode")
    if pm then
        pm:FireServer("Toggle")
        ui.notify({title = "Passive Mode", message = "Triggered Passive Mode!", duration = 3})
    else
        ui.notify({title = "Error", message = "PassiveMode Remote missing!", duration = 3})
    end
end

-- Helper: Check if Alive
local function IsAlive()
    local char = LocalPlayer.Character
    if not char then return false end
    local hum = char:FindFirstChild("Humanoid")
    if not hum or hum.Health <= 0 then return false end
    return true
end

-- Helper: Slide/Tween
local function SlideTo(targetPos)
    if not IsAlive() then return false end
    local char = LocalPlayer.Character
    local root = char:FindFirstChild("HumanoidRootPart")
    if not root then return false end

    local dist = (root.Position - targetPos).Magnitude
    local time = dist / Config.Speed
    
    local tweenInfo = TweenInfo.new(time, Enum.EasingStyle.Linear)
    local goal = {CFrame = CFrame.new(targetPos)}
    
    local tween = TweenService:Create(root, tweenInfo, goal)
    tween:Play()
    
    local passed = 0
    while passed < time do
        if not Config.Enabled then tween:Cancel(); return false end
        if not IsAlive() then tween:Cancel(); return false end
        task.wait(0.1)
        passed = passed + 0.1
    end
    return true
end

-- SHOP SEQUENCE
local function AutobuyforBank()
    local hasDrill = false
    if LocalPlayer.Backpack:FindFirstChild("Drill") then hasDrill = true end
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Drill") then hasDrill = true end

    if hasDrill then
        ui.notify({title = "Shop", message = "Drill found! Skipping shop...", duration = 2})
        return true
    end

    ui.notify({title = "Shop", message = "Buying Drill & Duffel...", duration = 2})
    
    if not SlideTo(Vector3.new(256, 4, 428)) then return false end
    task.wait(1)
    if not IsAlive() then return false end

    VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.E, false, game)
    task.wait(0.1)
    VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.E, false, game)
    task.wait(0.5)

    local GunDealer = ReplicatedStorage:WaitForChild("UI"):WaitForChild("GunDealer")

    if GunDealer then
        GunDealer:FireServer("Purchase", "Drill")
        task.wait(0.2) 
        GunDealer:FireServer("Purchase", "Duffel")
    end
    task.wait(2)
    if not IsAlive() then return false end

    if GunDealer then GunDealer:FireServer("Exit") end
    task.wait(0.5)
    workspace.CurrentCamera.CameraType = Enum.CameraType.Custom
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        workspace.CurrentCamera.CameraSubject = LocalPlayer.Character.Humanoid
    end
    return true
end

-- Helper: Equip Tool
local function EquipTool(name)
    local char = LocalPlayer.Character
    local backpack = LocalPlayer:FindFirstChild("Backpack")
    
    if char and backpack then
        if char:FindFirstChild(name) then return end
        local tool = backpack:FindFirstChild(name)
        if tool then
            tool.Parent = char
        end
    end
end

-- Helper: Fire ProximityPrompt
local function FirePrompts()
    local char = LocalPlayer.Character
    if not char then return end
    local root = char:FindFirstChild("HumanoidRootPart")
    if not root then return end
    
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("ProximityPrompt") then
            if v.Parent and v.Parent:IsA("BasePart") then
                if (v.Parent.Position - root.Position).Magnitude < 15 then
                    fireproximityprompt(v)
                end
            end
        end
    end
end

-- MAIN SEQUENCE
local function StartRobbery()
    task.spawn(function()
        -- Trigger Passive Mode ONCE at start
        TogglePassiveMode()
        task.wait(0.5)

        while Config.Enabled do
            local failed = false

            for _ = 1, 1 do -- Sequence Block
                -- [STEP 0] SHOP
                if not AutobuyforBank() then failed = true; break end

                -- [STEP 1] First Door
                if not SlideTo(Vector3.new(-225, 4, 94)) then failed = true; break end
                task.wait(0.5); FirePrompts(); task.wait(1)
                if not IsAlive() then failed = true; break end

                -- [STEP 2] Vault Door
                if not SlideTo(Vector3.new(-489, -255, -201)) then failed = true; break end
                EquipTool("Drill")
                task.wait(0.5); FirePrompts(); task.wait(1)
                if not IsAlive() then failed = true; break end

                -- [STEP 3] Safe Spot (Wait 15s)
                if not SlideTo(Vector3.new(-491, -237, -219)) then failed = true; break end
                ui.notify({title = "Bank", message = "Waiting 15s for guards...", duration = 3})
                for i = 1, 150 do 
                    if not Config.Enabled then failed = true; break end 
                    if not IsAlive() then failed = true; break end
                    task.wait(0.1) 
                end
                if failed then break end

                -- [STEP 4] Move to Gold Spot
                if not SlideTo(Vector3.new(-489, -255, -222)) then failed = true; break end

                -- [STEP 5] COLLECT GOLD
                ui.notify({title = "Bank", message = "Collecting Money...", duration = 3})
                local goldFolder = workspace:FindFirstChild("RobberyData") 
                    and workspace.RobberyData:FindFirstChild("BankData") 
                    and workspace.RobberyData.BankData:FindFirstChild("GoldBricks")

                if goldFolder then
                    local initialCount = #goldFolder:GetChildren()
                    local collected = 0
                    local timeout = 0

                    while collected < 4 and #goldFolder:GetChildren() > 0 and Config.Enabled do
                        if not IsAlive() then failed = true; break end
                        FirePrompts()
                        local currentCount = #goldFolder:GetChildren()
                        collected = initialCount - currentCount
                        timeout = timeout + 0.5
                        if timeout > 30 then break end
                        task.wait(0.5)
                    end
                else
                    ui.notify({title = "Error", message = "GoldBricks not found!", duration = 3})
                    task.wait(5)
                end
                if failed then break end

                -- [STEP 6] Exit/Next Door
                if not SlideTo(Vector3.new(-470, -255, -159)) then failed = true; break end
                task.wait(0.5); FirePrompts()
                if not IsAlive() then failed = true; break end

                -- [STEP 7] Sell to NPC
                local npc = workspace:FindFirstChild("RobbableNPC")
                if npc and npc:FindFirstChild("HumanoidRootPart") then
                    ui.notify({title = "Bank", message = "Selling to NPC...", duration = 3})
                    if not SlideTo(npc.HumanoidRootPart.Position) then failed = true; break end
                    
                    while npc.Parent and Config.Enabled do
                        if not IsAlive() then failed = true; break end
                        FirePrompts()
                        task.wait(0.1)
                    end
                else
                    ui.notify({title = "Error", message = "NPC not found!", duration = 3})
                end
                if failed then break end
            end 

            -- DEATH HANDLING
            if failed and not IsAlive() then
                ui.notify({title = "Status", message = "Died. Respawning...", duration = 3})
                LocalPlayer.CharacterAdded:Wait()
                task.wait(2)
            elseif failed and not Config.Enabled then
                ui.notify({title = "Status", message = "Robbery Stopped.", duration = 3})
                break
            end

            -- [STEP 8] AFK / COOLDOWN SPOT
            if Config.Enabled then
                if not SlideTo(Vector3.new(-209, 78, 312)) then task.wait(1) end
                ui.notify({title = "Cooldown", message = "Waiting 7 Minutes...", duration = 5})
                
                for i = 420, 1, -1 do
                    if not Config.Enabled then return end
                    task.wait(1)
                end
                ui.notify({title = "Status", message = "Restarting Robbery...", duration = 3})
                task.wait(1)
            end
        end
    end)
end

-- [[ 4. UI CONSTRUCTION ]] --

local window = ui.newWindow({
    text = 'FocusHub Bank Auto',
    resize = true,
    size = Vector2.new(450, 300)
})

local menu = window:addMenu({ text = 'Main' })
local section = menu:addSection({ text = 'Controls', side = 'auto' })

section:addToggle({ text = 'Enable Bank Auto', state = false }, function(v) 
    Config.Enabled = v 
    if v then
        StartRobbery()
        ui.notify({title = "Started", message = "Bank Auto Running...", duration = 3})
    else
        ui.notify({title = "Stopped", message = "Bank Auto Disabled.", duration = 3})
    end
end)

section:addSlider({ text = 'Move Speed', min = 16, max = 50, val = 30, step = 1 }, function(v) 
    Config.Speed = v 
end)

section:addButton({ text = 'Force Passive Mode' }, function()
    TogglePassiveMode()
end)

section:addLabel({ text = 'Status: Ready' })

print("Dollarware Gemini Bank Loaded.")
