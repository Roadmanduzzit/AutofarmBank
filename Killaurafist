-- // ========================================== //
-- //   DOLLARWARE FOCUS HUB V29 (MOUSE-LOCK)    //
-- // ========================================== //

-- [[ 1. DOLLARWARE LIBRARY SETUP ]] --
local uiLoader = loadstring(game:HttpGet('https://raw.githubusercontent.com/topitbopit/dollarware/main/library.lua'))
local ui = uiLoader({
    rounding = true,
    theme = 'midnight', 
    smoothDragging = true
})

-- [[ 2. VARIABLES & SERVICES ]] --
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Remote Check
local FistRemote = ReplicatedStorage:WaitForChild("Fist", 5)
if not FistRemote then 
    ui.notify({title = "Error", message = "Fist Remote not found!", duration = 5})
    return 
end

-- Config (Controlled by UI)
local Config = {
    LockKey = Enum.KeyCode.K,   -- Default Key
    KillDist = 19,
    PushDist = 8,
    AutoPush = true,
    AutoEquip = true,
    FaceTarget = true,
    Hooks = true,
    Enabled = true -- Master Switch
}

-- State
local CurrentTarget = nil
local CurrentHighlight = nil
local StatusLabel = nil -- Will be updated by UI

-- [[ 3. HELPER FUNCTIONS ]] --

-- Anti-Slow Hooks
if Config.Hooks then
    local mt = getrawmetatable(game)
    local oldNewIndex = mt.__newindex
    setreadonly(mt, false)

    mt.__newindex = newcclosure(function(self, key, value)
        if not checkcaller() then
            if key == "WalkSpeed" and self:IsA("Humanoid") then
                if value < 16 then return end 
            end
            if key == "Value" and self.Name == "Stamina" then
                return oldNewIndex(self, key, 100)
            end
        end
        return oldNewIndex(self, key, value)
    end)
    setreadonly(mt, true)
end

-- Highlight System
local function SetHighlight(targetChar)
    if CurrentHighlight then CurrentHighlight:Destroy() CurrentHighlight = nil end
    
    if targetChar then
        local hl = Instance.new("Highlight")
        hl.Adornee = targetChar
        hl.FillColor = Color3.fromRGB(255, 0, 0)
        hl.OutlineColor = Color3.fromRGB(255, 255, 255)
        hl.FillTransparency = 0.5
        hl.OutlineTransparency = 0
        hl.Parent = targetChar
        CurrentHighlight = hl
    end
end

-- Update UI Status
local function UpdateStatus(text)
    if StatusLabel then
        -- Dollarware doesn't support dynamic label updates easily, 
        -- but we can use notifications for major changes or just console print
        -- For a persistent status, we usually rely on the highlight.
        -- We will use a notification if target changes.
        -- ui.notify({title = "Target", message = text, duration = 1})
    end
end

-- [[ 4. UI CONSTRUCTION ]] --
local window = ui.newWindow({
    text = 'FocusHub V29 (Lock Aura)',
    resize = true,
    size = Vector2.new(500, 350)
})

local menu = window:addMenu({ text = 'Main' })

-- SECTION: SETTINGS
local secSettings = menu:addSection({ text = 'Aura Settings', side = 'left' })

secSettings:addToggle({ text = 'Master Switch', state = true }, function(v) Config.Enabled = v end)
secSettings:addToggle({ text = 'Auto Push', state = true }, function(v) Config.AutoPush = v end)
secSettings:addToggle({ text = 'Auto Equip Fist', state = true }, function(v) Config.AutoEquip = v end)
secSettings:addToggle({ text = 'Face Target', state = true }, function(v) Config.FaceTarget = v end)

secSettings:addSlider({ text = 'Hit Distance', min = 5, max = 25, val = 19, step = 1 }, function(v) Config.KillDist = v end)
secSettings:addSlider({ text = 'Push Distance', min = 5, max = 15, val = 8, step = 1 }, function(v) Config.PushDist = v end)

-- SECTION: CONTROLS
local secControls = menu:addSection({ text = 'Controls', side = 'right' })

secControls:addHotkey({ text = 'Lock Target Key' }, function(key) 
    Config.LockKey = key 
    ui.notify({title = "Keybind", message = "Lock Key set to: " .. tostring(key), duration = 2})
end)
-- Set Default Key manually in UI logic is tricky in Dollarware, usually requires binding manually.
-- For now, the input listener uses Config.LockKey which defaults to K.

secControls:addButton({ text = 'Reset Target' }, function()
    CurrentTarget = nil
    SetHighlight(nil)
    ui.notify({title = "Target", message = "Target Reset", duration = 2})
end)

secControls:addLabel({ text = 'Hover mouse over player' })
secControls:addLabel({ text = 'and press Key (K) to lock.' })


-- [[ 5. LOGIC LOOPS ]] --

-- INPUT LISTENER (LOCK SYSTEM)
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Config.LockKey then
        -- Raycast from Mouse
        local mouseTarget = Mouse.Target
        
        if mouseTarget then
            local character = mouseTarget:FindFirstAncestorOfClass("Model")
            if character then
                local player = Players:GetPlayerFromCharacter(character)
                
                if player and player ~= LocalPlayer then
                    -- NEW TARGET FOUND
                    CurrentTarget = player
                    SetHighlight(character)
                    ui.notify({title = "LOCKED", message = "Target: " .. player.Name, duration = 3})
                    return
                end
            end
        end
        
        -- Missed click -> Reset
        CurrentTarget = nil
        SetHighlight(nil)
        ui.notify({title = "UNLOCKED", message = "No Target", duration = 1})
    end
end)

-- AURA LOOP
task.spawn(function()
    while true do
        if Config.Enabled and CurrentTarget then
            -- Validation check
            if not CurrentTarget.Character or not CurrentTarget.Character:FindFirstChild("Humanoid") or CurrentTarget.Character.Humanoid.Health <= 0 then
                -- Target Dead/Gone
                SetHighlight(nil)
                CurrentTarget = nil
            elseif LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                
                local myRoot = LocalPlayer.Character.HumanoidRootPart
                local tRoot = CurrentTarget.Character.HumanoidRootPart
                
                if tRoot then
                    local dist = (myRoot.Position - tRoot.Position).Magnitude
                    
                    -- Update Highlight if respawned
                    if not CurrentHighlight or CurrentHighlight.Parent ~= CurrentTarget.Character then
                        SetHighlight(CurrentTarget.Character)
                    end
                    
                    -- ATTACK LOGIC
                    if dist <= Config.KillDist then
                        -- Auto Equip
                        if Config.AutoEquip and not LocalPlayer.Character:FindFirstChild("Fist") then
                            local tool = LocalPlayer.Backpack:FindFirstChild("Fist")
                            if tool then LocalPlayer.Character.Humanoid:EquipTool(tool) end
                        end
                        
                        -- Face Target
                        if Config.FaceTarget then
                            myRoot.CFrame = CFrame.new(myRoot.Position, Vector3.new(tRoot.Position.X, myRoot.Position.Y, tRoot.Position.Z))
                        end
                        
                        -- Push
                        if Config.AutoPush and dist < Config.PushDist then
                            FistRemote:FireServer("Push")
                        end
                        
                        -- Hit
                        if LocalPlayer.Character:FindFirstChild("Fist") then
                            local anim = "Punch" .. math.random(1, 2)
                            FistRemote:FireServer("SwingBegin", { anim })
                        end
                    end
                end
            end
        end
        task.wait(0.1) -- Loop Speed
    end
end)

print("Dollarware FocusHub V29 Loaded.")
